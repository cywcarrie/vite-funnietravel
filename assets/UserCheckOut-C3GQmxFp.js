import{_ as M,k as S,s as I,g as b,f as N,l as A,m as R,c as f,d as t,a as e,e as j,F as U,n as C,t as v,z as _,w as T,S as F,r as x,o as u,b as n,y as m,i as E,v as O,j as B,u as z}from"./index-BiSWBm_L.js";import{V as D}from"./VueLoading-Dl6tlsda.js";const H={BASE_URL:"/vite-funnietravel/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_APP_API:"https://vue3-course-api.hexschool.io/",VITE_APP_PATH:"funnietravel-api"},{VITE_APP_API:Y,VITE_APP_PATH:G}=H,J={components:{VueLoading:D},setup(){const p=B("$axios"),l=z(),g=S(),{cart:s}=I(g),y=b(!1),k=b(0),w=b(0),r=b(""),d=b(""),c=b(""),V=N({user:{name:"",email:"",tel:"",address:"",pay:"",bill:"",billNum:""},message:""});A(c,(o,i)=>{o.length<i.length&&o.charAt(o.length-1)===" "&&(c.value=i.slice(0,-2)),o.length>i.length&&(o.length+1)%5===0&&c.value.length!==0&&c.value.length<19&&(c.value=o+" ")}),A(d,(o,i)=>{o.length===2&&o.length>i.length?d.value+="/":o.length<i.length&&i.charAt(2)==="/"&&i.length===3&&(d.value=i.slice(0,1))});function a(){const o=`${Y}api/${G}/order`,i=V;y.value=!0,p.post(o,{data:i}).then(h=>{l.push(`/checkorder/${h.data.orderId}`),g.getCart()}).catch(h=>{var P,q;const L=((q=(P=h.response)==null?void 0:P.data)==null?void 0:q.message)||"發生錯誤，請稍後再試";F("error",L)}).finally(()=>{y.value=!1})}return R(()=>{g.getCart()}),{isLoading:y,total:k,final_total:w,form:V,coupon_code:r,expiryDate:d,cardNumber:c,cart:s,createOrder:a}}},K={class:"mb-5"},Q={class:"container"},W={class:"row my-5 py-5 justify-content-center"},X={class:"col-12 col-md-8"},Z={class:"col-12"},$={class:"table-responsive-md mb-5 mb-lg-0"},ee={class:"table align-middle table-borderless"},le={class:"text-center"},se={class:"table-nowrap fw-bold text-primary"},oe={class:"text-nowrap"},te={class:"text-end text-nowrap"},ae={key:0,class:"text-success text-end"},re={class:"text-end fs-5 text-primary fw-bold"},de={key:0},ne={class:"text-end text-success fs-5 fw-bold"},ie={class:"col-12"},me={class:"row d-flex justify-content-center mt-5"},ce={class:"mb-3"},fe={class:"mb-3"},ue={class:"mb-3"},be={class:"mb-3"},ve={class:"mb-3"},pe={class:"col-12 d-flex flex-md-row flex-column align-md-items-center"},xe={class:"d-flex"},ge={class:"form-check form-radio me-3"},ye={class:"form-check form-radio me-3"},Ve={class:"form-check form-radio"},_e={class:"mb-2 mb-md-0"},we={key:0,class:"mb-3"},he={class:"row"},ke={class:"col-12"},Pe={class:"my-3 col-12 col-md-6"},qe={class:"mb-3 col-12 col-md-6"},Ae={class:"mb-3"},Ue={class:"col-12 d-flex align-items-center"},Te={class:"d-flex"},Le={class:"form-check form-radio me-3"},Me={class:"form-check form-radio"},Se={key:1,class:"mb-3"},Ie={class:"mb-3"},Ne={class:"d-flex justify-content-between"};function Re(p,l,g,s,y,k){const w=x("VueLoading"),r=x("FieldVue"),d=x("ErrorMessage"),c=x("RouterLink"),V=x("FormVue");return u(),f(U,null,[t(w,{active:s.isLoading},null,8,["active"]),l[36]||(l[36]=e("div",{class:"my-5 position-relative banner container-fluid",style:{background:"linear-gradient(to right, #336b87, #f0e9e0)"}},[e("h2",{class:"position-absolute text-center text-white fw-bolder banner-title fs-2"},"結帳流程")],-1)),e("section",K,[e("div",Q,[l[35]||(l[35]=j('<div class="d-flex justify-content-center align-items-center my-5"><div class="d-flex flex-column text-center fw-bold fs-5 text-secondary pay-header active"><i class="bi bi-1-circle mb-1"></i> 填寫資料 </div><i class="bi bi-caret-right-fill fs-5 mx-2 text-secondary"></i><div class="d-flex flex-column text-center fw-bold fs-5 text-secondary pay-header"><i class="bi bi-2-circle mb-1"></i> 確認付款 </div><i class="bi bi-caret-right-fill fs-5 mx-2 text-secondary"></i><div class="d-flex flex-column text-center fw-bold fs-5 text-secondary pay-header"><i class="bi bi-3-circle mb-1"></i> 訂單完成 </div></div>',1)),e("div",W,[e("div",X,[e("div",Z,[l[16]||(l[16]=e("h3",{class:"text-center fw-bold mb-4"},"行程明細",-1)),e("div",$,[e("table",ee,[l[15]||(l[15]=e("thead",{class:"text-center table-secondary"},[e("tr",{class:"table-nowrap"},[e("th",null,"行程名稱"),e("th",{class:"text-nowrap"},"數量"),e("th",{class:"text-end"},"價格")])],-1)),e("tbody",le,[(u(!0),f(U,null,C(s.cart.carts,a=>(u(),f("tr",{class:"table-nowrap",key:a.id},[e("td",se,v(a.product.title),1),e("td",oe,v(a.qty)+"/"+v(a.product.unit),1),e("td",te,[s.cart.final_total!==s.cart.total?(u(),f("small",ae,"優惠價：")):_("",!0),n(" "+v(p.$format.currency(a.final_total)),1)])]))),128))]),e("tfoot",null,[e("tr",null,[l[13]||(l[13]=e("td",{colspan:"2",class:"text-end fs-5"},"總計",-1)),e("td",re,v(p.$format.currency(s.cart.total)),1)]),s.cart.final_total!==s.cart.total?(u(),f("tr",de,[l[14]||(l[14]=e("td",{colspan:"2",class:"text-end text-success fs-5"},"優惠價",-1)),e("td",ne,v(p.$format.currency(s.cart.final_total)),1)])):_("",!0)])])])]),e("div",ie,[e("div",me,[l[34]||(l[34]=e("h3",{class:"text-center fw-bold mb-4"},"訂購人資訊",-1)),t(V,{onSubmit:s.createOrder,class:"col-12"},{default:T(({errors:a})=>[e("div",ce,[l[17]||(l[17]=e("label",{for:"name",class:"form-label fw-bold"},[n("訂購人姓名"),e("small",{class:"ps-1 text-danger fw-bold"},"*")],-1)),t(r,{id:"name",name:"姓名",type:"text",class:m(["form-control",{"is-invalid":a.姓名}]),placeholder:"請輸入姓名",rules:"required",modelValue:s.form.user.name,"onUpdate:modelValue":l[0]||(l[0]=o=>s.form.user.name=o)},null,8,["class","modelValue"]),t(d,{name:"姓名",class:"invalid-feedback"})]),e("div",fe,[l[18]||(l[18]=e("label",{for:"email",class:"form-label fw-bold"},[n("電子信箱"),e("small",{class:"ps-1 text-danger fw-bold"},"*")],-1)),t(r,{id:"email",name:"email",type:"email",class:m(["form-control",{"is-invalid":a.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:s.form.user.email,"onUpdate:modelValue":l[1]||(l[1]=o=>s.form.user.email=o)},null,8,["class","modelValue"]),t(d,{name:"email",class:"invalid-feedback"})]),e("div",ue,[l[19]||(l[19]=e("label",{for:"tel",class:"form-label fw-bold"},[n("電話"),e("small",{class:"ps-1 text-danger fw-bold"},"*")],-1)),t(r,{id:"tel",name:"電話",type:"tel",class:m(["form-control",{"is-invalid":a.電話}]),placeholder:"不含 - 符號的手機或室話",rules:"required|numeric|min:8|max:10",modelValue:s.form.user.tel,"onUpdate:modelValue":l[2]||(l[2]=o=>s.form.user.tel=o)},null,8,["class","modelValue"]),t(d,{name:"電話",class:"invalid-feedback"})]),e("div",be,[l[20]||(l[20]=e("label",{for:"address",class:"form-label fw-bold"},[n("地址"),e("small",{class:"ps-1 text-danger fw-bold"},"*")],-1)),t(r,{id:"address",name:"地址",type:"text",class:m(["form-control",{"is-invalid":a.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:s.form.user.address,"onUpdate:modelValue":l[3]||(l[3]=o=>s.form.user.address=o)},null,8,["class","modelValue"]),t(d,{name:"地址",class:"invalid-feedback"})]),e("div",ve,[e("fieldset",pe,[l[24]||(l[24]=e("legend",{class:"form-label me-md-4 me-0 fs-6 fs-md-5 w-auto mb-2 mb-md-0 fw-bold"},[n(" 付款方式"),e("small",{class:"ps-1 text-danger fw-bold"},"*")],-1)),e("div",{class:m(["normal-input",{error:a.付款方式}])},[e("div",xe,[e("div",ge,[t(r,{class:"form-check-input",type:"radio",name:"付款方式",rules:"required",id:"信用卡",value:"信用卡",modelValue:s.form.user.pay,"onUpdate:modelValue":l[4]||(l[4]=o=>s.form.user.pay=o)},null,8,["modelValue"]),l[21]||(l[21]=e("label",{class:"form-check-label",for:"信用卡"},"信用卡",-1))]),e("div",ye,[t(r,{class:"form-check-input",type:"radio",name:"付款方式",rules:"required",id:"ATM 轉帳",value:"ATM 轉帳",modelValue:s.form.user.pay,"onUpdate:modelValue":l[5]||(l[5]=o=>s.form.user.pay=o)},null,8,["modelValue"]),l[22]||(l[22]=e("label",{class:"form-check-label",for:"ATM 轉帳"},"ATM 轉帳",-1))]),e("div",Ve,[t(r,{class:"form-check-input",type:"radio",name:"付款方式",rules:"required",id:"linePay",value:"Line Pay",modelValue:s.form.user.pay,"onUpdate:modelValue":l[6]||(l[6]=o=>s.form.user.pay=o)},null,8,["modelValue"]),l[23]||(l[23]=e("label",{class:"form-check-label",for:"linePay"},"Line Pay",-1))])]),e("div",_e,[t(d,{name:"付款方式",class:"error-text position-absolute text-danger mb-2 mb-md-0"})])],2)])]),s.form.user.pay==="信用卡"?(u(),f("div",we,[l[27]||(l[27]=e("label",{for:"cardNum",class:"form-label fw-bold"},[n("信用卡號"),e("small",{class:"ps-1 text-danger fw-bold"},"*")],-1)),e("div",he,[e("div",ke,[t(r,{id:"cardNum",name:"卡號",type:"tel",class:m(["form-control",{"is-invalid":a.卡號}]),maxlength:"19",placeholder:"**** **** **** ****",rules:"required",modelValue:s.cardNumber,"onUpdate:modelValue":l[7]||(l[7]=o=>s.cardNumber=o)},null,8,["class","modelValue"]),t(d,{name:"卡號",class:"invalid-feedback"}),e("div",Pe,[l[25]||(l[25]=e("label",{for:"period",class:"form-label required fw-bold"},[n("有效日期"),e("small",{class:"ps-1 text-danger fw-bold"},"*")],-1)),t(r,{id:"period",name:"有效日期",type:"tel",class:m(["form-control",{"is-invalid":a.有效日期}]),placeholder:"MM/YY",maxlength:"5",modelValue:s.expiryDate,"onUpdate:modelValue":l[8]||(l[8]=o=>s.expiryDate=o),rules:"required"},null,8,["modelValue","class"]),t(d,{name:"有效日期",class:"invalid-feedback"})]),e("div",qe,[l[26]||(l[26]=e("label",{for:"checkCode",class:"form-label required fw-bold"},[n("檢查碼"),e("small",{class:"ps-1 text-danger fw-bold"},"*")],-1)),t(r,{id:"checkCode",name:"檢查碼",type:"text",class:m(["form-control",{"is-invalid":a.檢查碼}]),maxlength:"3",placeholder:"CVC/CVV",rules:"required|length:3|numeric:true"},null,8,["class"]),t(d,{name:"檢查碼",class:"invalid-feedback"})])])])])):_("",!0),e("div",Ae,[e("fieldset",Ue,[l[30]||(l[30]=e("legend",{class:"form-label me-4 mb-0 fs-6 fs-md-5 w-auto fw-bold"},[n(" 發票類型"),e("small",{class:"ps-1 text-danger fw-bold"},"*")],-1)),e("div",{class:m(["normal-input",{error:a.發票類型}])},[e("div",Te,[e("div",Le,[t(r,{class:"form-check-input",type:"radio",name:"發票類型",rules:"required",id:"紙本發票",value:"紙本發票",modelValue:s.form.user.bill,"onUpdate:modelValue":l[9]||(l[9]=o=>s.form.user.bill=o)},null,8,["modelValue"]),l[28]||(l[28]=e("label",{class:"form-check-label",for:"紙本發票"},"紙本發票",-1))]),e("div",Me,[t(r,{class:"form-check-input",type:"radio",name:"發票類型",rules:"required",id:"電子載具",value:"電子載具",modelValue:s.form.user.bill,"onUpdate:modelValue":l[10]||(l[10]=o=>s.form.user.bill=o)},null,8,["modelValue"]),l[29]||(l[29]=e("label",{class:"form-check-label",for:"電子載具"},"電子載具",-1))])]),t(d,{name:"發票類型",class:"error-text position-absolute text-danger"})],2)])]),s.form.user.bill==="電子載具"?(u(),f("div",Se,[t(r,{name:"電子載具",type:"text",class:m(["form-control",{"is-invalid":a.電子載具}]),placeholder:"請輸入  '/'  開頭的載具號碼",rules:"required",modelValue:s.form.user.billNum,"onUpdate:modelValue":l[11]||(l[11]=o=>s.form.user.billNum=o)},null,8,["class","modelValue"]),t(d,{name:"電子載具",class:"invalid-feedback"})])):_("",!0),e("div",Ie,[l[31]||(l[31]=e("label",{for:"message",class:"form-label fw-bold"},"備註",-1)),E(e("textarea",{name:"",id:"message",class:"form-control",rows:"3","onUpdate:modelValue":l[12]||(l[12]=o=>s.form.message=o)},null,512),[[O,s.form.message]])]),e("div",Ne,[t(c,{class:"btn btn-outline-primary",to:"/cart"},{default:T(()=>l[32]||(l[32]=[e("i",{class:"bi bi-caret-left-fill"},null,-1),n("回上一頁")])),_:1}),l[33]||(l[33]=e("button",{type:"submit",class:"btn btn-primary"},[n(" 確認訂單"),e("i",{class:"bi bi-caret-right-fill"})],-1))])]),_:1},8,["onSubmit"])])])])])])])],64)}const Fe=M(J,[["render",Re]]);export{Fe as default};
