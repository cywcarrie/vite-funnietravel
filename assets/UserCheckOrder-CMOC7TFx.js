import{_ as R,R as I,g as _,m as O,c as a,d as g,a as t,b as p,y as k,z as w,h as S,F as P,n as T,t as r,w as j,x as C,u as N,S as y,r as V,o as l,j as B}from"./index-wmRt45v3.js";import{V as D}from"./VueLoading-BftmEwdA.js";const M={BASE_URL:"/vite-funnietravel/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_APP_API:"https://vue3-course-api.hexschool.io/",VITE_APP_PATH:"funnietravel-api"},{VITE_APP_API:L,VITE_APP_PATH:A}=M,z={components:{VueLoading:D,RouterLink:I},setup(){const c=B("$axios"),s=C(),x=N(),e=_({user:{}}),i=_(""),d=_(!1);function u(){const o=`${L}api/${A}/order/${i.value}`;d.value=!0,c.get(o).then(n=>{n.data.success&&(e.value=n.data.order)}).catch(n=>{var b,f,h;if(((b=n.response)==null?void 0:b.status)===404)x.push("/not-found");else{const E=((h=(f=n.response)==null?void 0:f.data)==null?void 0:h.message)||"發生錯誤，請稍後再試";y("error",E)}}).finally(()=>{d.value=!1})}function m(){const o=`${L}api/${A}/pay/${i.value}`;d.value=!0,c.post(o).then(n=>{n.data.success&&(y("success","付款成功"),u())}).catch(n=>{var b,f;const v=((f=(b=n.response)==null?void 0:b.data)==null?void 0:f.message)||"發生錯誤，請稍後再試";y("error",v)}).finally(()=>{d.value=!1})}return O(()=>{if(i.value=s.params.orderId,!i.value){x.push("/not-found");return}u()}),{order:e,orderId:i,isLoading:d,getOrder:u,payOrder:m}}},F={class:"mb-5"},H={class:"container"},U={class:"d-flex justify-content-center align-items-center mb-5"},q={class:"row justify-content-center align-items-center"},G={class:"col-md-10"},J={key:0,class:"text-center my-5"},K={class:"my-5 row justify-content-center"},Q={class:"border border-primary rounded-4 p-4 mb-5"},W={class:"table align-middle table-white table-borderless mb-4"},X={class:"text-center text-primary fw-bold"},Y={class:"text-center text-nowrap"},Z={class:"text-center text-nowrap"},$={class:"fs-5 text-primary fw-bold text-nowrap"},tt={class:"border border-primary rounded-4 p-4 mb-4"},st={class:"table table-white table-borderless mb-4"},et={class:"table-nowrap"},ot={class:"text-nowrap"},rt={class:"table-nowrap"},nt={class:"text-nowrap"},at={class:"table-nowrap"},lt={class:"text-nowrap"},it={class:"table-nowrap"},dt={class:"text-nowrap"},ct={class:"table-nowrap"},ut={class:"text-nowrap"},bt={class:"table-nowrap"},ft={class:"text-nowrap"},pt={class:"table-nowrap"},xt={key:0,class:"text-nowrap fw-bold text-danger"},mt={key:1,class:"text-success fw-bold text-nowrap"},_t={key:0,class:"text-end"},wt={key:1,class:"text-end"};function yt(c,s,x,e,i,d){const u=V("VueLoading"),m=V("RouterLink");return l(),a(P,null,[g(u,{active:e.isLoading},null,8,["active"]),s[20]||(s[20]=t("div",{class:"my-5 position-relative banner container-fluid",style:{background:"linear-gradient(to right, #336b87, #f0e9e0)"}},[t("h2",{class:"position-absolute text-center text-white fw-bolder banner-title fs-2"},"結帳流程")],-1)),t("section",F,[t("div",H,[t("div",U,[s[3]||(s[3]=t("div",{class:"d-flex flex-column text-center fw-bold fs-5 text-secondary pay-header"},[t("i",{class:"bi bi-1-circle mb-1"}),p(" 填寫資料 ")],-1)),s[4]||(s[4]=t("i",{class:"bi bi-caret-right-fill fs-5 mx-2 text-secondary"},null,-1)),t("div",{class:k(["d-flex flex-column text-center fw-bold fs-5 text-secondary pay-header",{active:e.order.is_paid===!1}])},s[1]||(s[1]=[t("i",{class:"bi bi-2-circle mb-1"},null,-1),p(" 確認付款 ")]),2),s[5]||(s[5]=t("i",{class:"bi bi-caret-right-fill fs-5 mx-2 text-secondary"},null,-1)),t("div",{class:k(["d-flex flex-column text-center fw-bold fs-5 text-secondary pay-header",{active:e.order.is_paid===!0}])},s[2]||(s[2]=[t("i",{class:"bi bi-3-circle mb-1"},null,-1),p(" 訂單完成 ")]),2)]),t("div",q,[t("div",G,[e.order.is_paid===!0?(l(),a("div",J,s[6]||(s[6]=[t("div",{class:"d-flex justify-content-center align-items-center"},[t("i",{class:"bi bi-check-circle-fill fs-2 pe-2 text-success"}),t("p",{class:"fw-bold mb-0 text-success fs-2"},"付款成功 !")],-1),t("p",{class:"fs-5 fw-bold mt-4"},"感謝您的訂購，訂單明細將會寄送至您的電子信箱 !",-1)]))):w("",!0),t("div",K,[s[19]||(s[19]=t("h3",{class:"text-center fw-bold mb-4"},"訂單明細",-1)),t("form",{class:"col-lg-6",onSubmit:s[0]||(s[0]=S((...o)=>e.payOrder&&e.payOrder(...o),["prevent"]))},[t("div",Q,[t("table",W,[s[8]||(s[8]=t("thead",{class:"text-center bg-light"},[t("tr",null,[t("th",{class:"text-nowrap"},"行程名稱"),t("th",{class:"text-center text-nowrap"},"數量"),t("th",{class:"text-nowrap"},"價格")])],-1)),t("tbody",null,[(l(!0),a(P,null,T(e.order.products,o=>(l(),a("tr",{key:o.id},[t("td",X,r(o.product.title),1),t("td",Y,r(o.qty)+"/"+r(o.product.unit),1),t("td",Z,r(c.$format.currency(o.final_total)),1)]))),128))]),t("tfoot",null,[t("tr",null,[s[7]||(s[7]=t("td",{colspan:"2",class:"text-end text-nowrap"},"總計",-1)),t("td",$,r(c.$format.currency(e.order.total)),1)])])])]),s[18]||(s[18]=t("h3",{class:"text-center fw-bold mb-4"},"訂購人資訊",-1)),t("div",tt,[t("table",st,[t("tbody",null,[t("tr",et,[s[9]||(s[9]=t("th",null,"訂單編號",-1)),t("td",ot,r(e.order.id),1)]),t("tr",rt,[s[10]||(s[10]=t("th",{class:"text-nowrap"},"姓名",-1)),t("td",nt,r(e.order.user.name),1)]),t("tr",at,[s[11]||(s[11]=t("th",{width:"100",class:"text-nowrap"},"Email",-1)),t("td",lt,r(e.order.user.email),1)]),t("tr",it,[s[12]||(s[12]=t("th",{class:"text-nowrap"},"電話",-1)),t("td",dt,r(e.order.user.tel),1)]),t("tr",ct,[s[13]||(s[13]=t("th",null,"地址",-1)),t("td",ut,r(e.order.user.address),1)]),t("tr",bt,[s[14]||(s[14]=t("th",null,"付款方式",-1)),t("td",ft,r(e.order.user.pay),1)]),t("tr",pt,[s[15]||(s[15]=t("th",null,"付款狀態",-1)),t("td",null,[e.order.is_paid?(l(),a("span",mt,"付款完成")):(l(),a("span",xt,"尚未付款"))])])])])]),e.order.is_paid===!1?(l(),a("div",_t,s[16]||(s[16]=[t("button",{class:"btn btn-primary ms-auto",type:"submit"},[p(" 確認付款"),t("i",{class:"bi bi-caret-right-fill"})],-1)]))):w("",!0),e.order.is_paid===!0?(l(),a("div",wt,[g(m,{to:"/products/全部",class:"btn btn-primary ms-auto"},{default:j(()=>s[17]||(s[17]=[t("i",{class:"bi bi-cart pe-1"},null,-1),p("繼續選購")])),_:1})])):w("",!0)],32)])])])])])],64)}const gt=R(z,[["render",yt]]);export{gt as default};
