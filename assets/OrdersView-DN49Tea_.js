import{_ as A,g as c,l as N,o as a,c as d,a as t,t as n,z as E,F as x,n as D,m as T,d as w,S as y,r as C,y as U,i as B,N as j,j as R}from"./index-D2xjZAbM.js";import{V as q}from"./VueLoading-DgkkEqNq.js";import{u as z,D as F}from"./DelModal-fjQsTSXL.js";import{P as H}from"./PaginationComponent-O4t5Vebj.js";const G={name:"orderModal",props:{order:{type:Object,default(){return{}}}},emits:["update-product","update-order"],setup(u,{emit:e}){const{modalElement:M,showModal:o,hideModal:r}=z(),g=c(""),s=c({}),_=c({}),O=c(!1);N(()=>u.order,l=>{_.value=l,O.value=_.value.is_paid});function b(){e("update-order",_.value)}return{modal:g,status:s,tempOrder:_,isPaid:O,showModal:o,hideModal:r,modalElement:M,pushOrderModal:b}}},J={class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modalElement"},K={class:"modal-dialog modal-xl",role:"document"},Q={class:"modal-content border-0"},W={class:"modal-body"},X={class:"row"},Y={class:"col-md-4"},Z={class:"table"},tt={key:0},et={class:"col-md-8"},ot={class:"table"},lt={key:0},nt={key:1},st={key:0,class:"text-success"},at={key:1,class:"text-body-secondary"},dt={class:"table"},rt={class:"text-end"},it={class:"modal-footer"};function ut(u,e,M,o,r,g){return a(),d("div",J,[t("div",K,[t("div",Q,[e[15]||(e[15]=t("div",{class:"modal-header bg-primary text-white"},[t("h5",{class:"modal-title",id:"exampleModalLabel"},[t("span",null,"訂單")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),t("div",W,[t("div",X,[t("div",Y,[e[5]||(e[5]=t("h3",null,"用戶資料",-1)),t("table",Z,[o.tempOrder.user?(a(),d("tbody",tt,[t("tr",null,[e[1]||(e[1]=t("th",{class:"order-modal-table"},"姓名",-1)),t("td",null,n(o.tempOrder.user.name),1)]),t("tr",null,[e[2]||(e[2]=t("th",null,"Email",-1)),t("td",null,n(o.tempOrder.user.email),1)]),t("tr",null,[e[3]||(e[3]=t("th",null,"電話",-1)),t("td",null,n(o.tempOrder.user.tel),1)]),t("tr",null,[e[4]||(e[4]=t("th",null,"地址",-1)),t("td",null,n(o.tempOrder.user.address),1)])])):E("",!0)])]),t("div",et,[e[12]||(e[12]=t("h3",null,"訂單細節",-1)),t("table",ot,[t("tbody",null,[t("tr",null,[e[6]||(e[6]=t("th",{class:"order-modal-table"},"訂單編號",-1)),t("td",null,n(o.tempOrder.id),1)]),t("tr",null,[e[7]||(e[7]=t("th",null,"下單時間",-1)),t("td",null,n(u.$format.date(o.tempOrder.create_at)),1)]),t("tr",null,[e[8]||(e[8]=t("th",null,"付款時間",-1)),t("td",null,[o.tempOrder.paid_date?(a(),d("span",lt,n(u.$format.date(o.tempOrder.paid_date)),1)):(a(),d("span",nt,"時間不正確"))])]),t("tr",null,[e[9]||(e[9]=t("th",null,"付款狀態",-1)),t("td",null,[o.tempOrder.is_paid?(a(),d("strong",st,"已付款")):(a(),d("span",at,"尚未付款"))])]),t("tr",null,[e[10]||(e[10]=t("th",null,"總金額",-1)),t("td",null,n(u.$format.currency(o.tempOrder.total)),1)])])]),e[13]||(e[13]=t("h3",null,"選購商品",-1)),t("table",dt,[e[11]||(e[11]=t("thead",null,[t("tr")],-1)),t("tbody",null,[(a(!0),d(x,null,D(o.tempOrder.products,s=>(a(),d("tr",{key:s.id},[t("th",null,n(s.product.title),1),t("td",null,n(s.qty)+" / "+n(s.product.unit),1),t("td",rt,n(u.$format.currency(s.final_total)),1)]))),128))])])])])]),t("div",it,[e[14]||(e[14]=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 關閉 ",-1)),t("button",{type:"button",class:"btn btn-primary",onClick:e[0]||(e[0]=(...s)=>o.pushOrderModal&&o.pushOrderModal(...s))},"確認")])])])],512)}const ct=A(G,[["render",ut]]),pt={BASE_URL:"/vite-funnietravel/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_APP_API:"https://vue3-course-api.hexschool.io/",VITE_APP_PATH:"funnietravel-api"},{VITE_APP_API:P,VITE_APP_PATH:$}=pt,mt={components:{VueLoading:q,Pagination:H,DelModal:F,OrderModal:ct},setup(){const u=R("$axios"),e=c([]),M=c(!1),o=c({}),r=c(!1),g=c({}),s=c(1),_=c(null),O=c(null);function b(i=1){s.value=i;const p=`${P}api/${$}/admin/orders?page=${i}`;r.value=!0,u.get(p).then(m=>{e.value=m.data.orders,o.value=m.data.pagination}).catch(m=>{var v,k;const h=((k=(v=m.response)==null?void 0:v.data)==null?void 0:k.message)||"發生錯誤，請稍後再試";y("error",h)}).finally(()=>{r.value=!1})}function l(i){g.value={...i},_.value.showModal()}function f(i){g.value={...i},O.value.showModal()}function V(i){const p=`${P}api/${$}/admin/order/${i.id}`,m={is_paid:i.is_paid};r.value=!0,u.put(p,{data:m}).then(h=>{h.data.success?(b(s.value),y("success","更新付款狀態成功")):y("error","更新付款狀態失敗")}).catch(h=>{var k,I;const v=((I=(k=h.response)==null?void 0:k.data)==null?void 0:I.message)||"發生錯誤，請稍後再試";y("error",v)}).finally(()=>{r.value=!1})}function L(i){const p=`${P}api/${$}/admin/order/${i.id}`,m={is_paid:i.is_paid};r.value=!0;const h=_.value;u.put(p,{data:m}).then(v=>{r.value=!1,h.hideModal(),v.data.success?(b(s.value),y("success","確認成功")):(r.value=!1,y("error","確認失敗"))})}function S(){const i=`${P}api/${$}/admin/order/${g.value.id}`;r.value=!0,u.delete(i).then(p=>{O.value.hideModal(),p.data.success?(y("success","刪除成功"),b(s.value)):y("error","刪除失敗")}).catch(p=>{var h,v;const m=((v=(h=p.response)==null?void 0:h.data)==null?void 0:v.message)||"發生錯誤，請稍後再試";y("error",m)}).finally(()=>{r.value=!1})}return T(()=>{b()}),{orders:e,isNew:M,pagination:o,isLoading:r,tempOrder:g,currentPage:s,getOrders:b,openModal:l,openDelOrderModal:f,updatePaid:V,delOrder:S,orderModal:_,delModal:O,checkOrderInfo:L}}},_t={class:"table-responsive"},ft={class:"table mt-4"},ht=["textContent"],bt={class:"list-unstyled text-nowrap"},vt={class:"text-nowrap"},yt={class:"form-check form-switch"},gt=["id","onUpdate:modelValue","onChange"],Ot=["for"],Mt={key:0},kt={key:1},xt={class:"btn-group"},wt=["onClick"],Ct=["onClick"];function Pt(u,e,M,o,r,g){const s=C("VueLoading"),_=C("OrderModal"),O=C("DelModal"),b=C("Pagination");return a(),d(x,null,[w(s,{active:o.isLoading},null,8,["active"]),t("div",_t,[t("table",ft,[e[0]||(e[0]=t("thead",null,[t("tr",{class:"table-nowrap"},[t("th",{class:"text-nowrap"},"購買時間"),t("th",null,"Email"),t("th",{class:"text-nowrap"},"購買款項"),t("th",{class:"text-nowrap"},"應付金額"),t("th",{class:"text-nowrap"},"是否付款"),t("th",null,"編輯")])],-1)),t("tbody",null,[(a(!0),d(x,null,D(o.orders,l=>(a(),d(x,{key:`orders ${l.id}`},[o.orders.length?(a(),d("tr",{key:0,class:U({"text-secondary":!l.is_paid})},[t("td",null,n(u.$format.date(l.create_at)),1),t("td",null,[l.user?(a(),d("span",{key:0,textContent:n(l.user.email)},null,8,ht)):E("",!0)]),t("td",null,[t("ul",bt,[(a(!0),d(x,null,D(l.products,(f,V)=>(a(),d("li",{key:V},n(f.product.title)+" 數量："+n(f.qty)+" "+n(f.product.unit),1))),128))])]),t("td",vt,n(l.total),1),t("td",null,[t("div",yt,[B(t("input",{class:"form-check-input",type:"checkbox",id:`paidSwitch${l.id}`,"onUpdate:modelValue":f=>l.is_paid=f,onChange:f=>o.updatePaid(l)},null,40,gt),[[j,l.is_paid]]),t("label",{class:"form-check-label text-nowrap",for:`paidSwitch${l.id}`},[l.is_paid?(a(),d("span",Mt,"已付款")):(a(),d("span",kt,"未付款"))],8,Ot)])]),t("td",null,[t("div",xt,[t("button",{class:"btn btn-outline-primary btn-sm",type:"button",onClick:f=>o.openModal(l)}," 檢視 ",8,wt),t("button",{class:"btn btn-outline-danger btn-sm",type:"button",onClick:f=>o.openDelOrderModal(l)}," 刪除 ",8,Ct)])])],2)):E("",!0)],64))),128))])])]),w(_,{order:o.tempOrder,ref:"orderModal",onUpdateOrder:o.checkOrderInfo},null,8,["order","onUpdateOrder"]),w(O,{item:o.tempOrder,ref:"delModal",onDelItem:o.delOrder},null,8,["item","onDelItem"]),w(b,{pages:o.pagination,onEmitPages:o.getOrders},null,8,["pages","onEmitPages"])],64)}const It=A(mt,[["render",Pt]]);export{It as default};
