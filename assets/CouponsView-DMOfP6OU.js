import{V as A}from"./VueLoading-DbF5Y1Mv.js";import{_ as T,g as b,l as P,o as f,c as C,a as o,i as h,v as y,M as I,m as L,d as D,b as S,F as U,x as N,S as r,r as k,t as w,j as O}from"./index-BMKnvvao.js";import{u as j,D as B}from"./DelModal-CYm9Hkdp.js";const R={name:"couponModal",props:{coupon:{type:Object,default:()=>({})}},emits:["update-coupon"],setup(p,{emit:e}){const{modalElement:u,showModal:t,hideModal:c}=j(),a=b({}),n=b("");P(()=>p.coupon,v=>{a.value={...v};const l=new Date(a.value.due_date*1e3);n.value=l.toISOString().split("T")[0]}),P(n,v=>{a.value.due_date=Math.floor(new Date(v)/1e3)});function M(){e("update-coupon",a.value),c()}return{modalElement:u,showModal:t,hideModal:c,tempCoupon:a,due_date:n,pushCoupon:M}}},F={class:"modal fade",id:"couponModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modalElement"},H={class:"modal-dialog",role:"document"},q={class:"modal-content"},z={class:"modal-body"},G={class:"mb-3"},J={class:"mb-3"},K={class:"mb-3"},Q={class:"mb-3"},W={class:"mb-3"},X={class:"form-check"},Y={class:"modal-footer"};function Z(p,e,u,t,c,a){return f(),C("div",F,[o("div",H,[o("div",q,[e[12]||(e[12]=o("div",{class:"modal-header"},[o("h5",{class:"modal-title",id:"exampleModalLabel"},"優惠券"),o("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),o("div",z,[o("div",G,[e[6]||(e[6]=o("label",{for:"title"},"標題",-1)),h(o("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":e[0]||(e[0]=n=>t.tempCoupon.title=n),placeholder:"請輸入標題"},null,512),[[y,t.tempCoupon.title]])]),o("div",J,[e[7]||(e[7]=o("label",{for:"coupon_code"},"優惠碼",-1)),h(o("input",{type:"text",class:"form-control",id:"coupon_code","onUpdate:modelValue":e[1]||(e[1]=n=>t.tempCoupon.code=n),placeholder:"請輸入優惠碼"},null,512),[[y,t.tempCoupon.code]])]),o("div",K,[e[8]||(e[8]=o("label",{for:"due_date"},"到期日",-1)),h(o("input",{type:"date",class:"form-control",id:"due_date","onUpdate:modelValue":e[2]||(e[2]=n=>t.due_date=n)},null,512),[[y,t.due_date]])]),o("div",Q,[e[9]||(e[9]=o("label",{for:"price"},"折扣百分比",-1)),h(o("input",{type:"number",class:"form-control",id:"price","onUpdate:modelValue":e[3]||(e[3]=n=>t.tempCoupon.percent=n),placeholder:"請輸入折扣百分比"},null,512),[[y,t.tempCoupon.percent,void 0,{number:!0}]])]),o("div",W,[o("div",X,[h(o("input",{class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":e[4]||(e[4]=n=>t.tempCoupon.is_enabled=n),id:"is_enabled"},null,512),[[I,t.tempCoupon.is_enabled]]),e[10]||(e[10]=o("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1))])])]),o("div",Y,[e[11]||(e[11]=o("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"關閉",-1)),o("button",{type:"button",class:"btn btn-primary",onClick:e[5]||(e[5]=(...n)=>t.pushCoupon&&t.pushCoupon(...n))},"確認")])])])],512)}const oo=T(R,[["render",Z]]),eo={BASE_URL:"/vite-funnietravel/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_APP_API:"https://vue3-course-api.hexschool.io/",VITE_APP_PATH:"funnietravel-api"},{VITE_APP_API:g,VITE_APP_PATH:x}=eo,to={components:{VueLoading:A,CouponModal:oo,DelModal:B},props:{config:Object},setup(){const p=O("$axios"),e=b({}),u=b({title:"",is_enabled:0,percent:100,code:""}),t=b(!1),c=b(!1),a=b(null),n=b(null);function M(d,s){c.value=d,c.value?u.value.due_date=new Date().getTime()/1e3:u.value={...s},a.value.showModal()}function v(d){u.value={...d},n.value.showModal()}function l(){const d=`${g}api/${x}/admin/coupons`;t.value=!0,p.get(d,u.value).then(s=>{e.value=s.data.coupons}).catch(s=>{var _,m;const i=((m=(_=s.response)==null?void 0:_.data)==null?void 0:m.message)||"發生錯誤，請稍後再試";r("error",i)}).finally(()=>{t.value=!1})}function V(d){if(c.value){const s=`${g}api/${x}/admin/coupon`;t.value=!0,p.post(s,{data:d}).then(i=>{t.value=!1,i.data.success?(r("success","新增優惠劵成功"),l(),a.value.hideModal()):r("error","新增優惠劵失敗")})}else{const s=`${g}api/${x}/admin/coupon/${d.id}`;t.value=!0,p.put(s,{data:d}).then(i=>{i.data.success?(r("success","更新優惠劵成功"),l(),a.value.hideModal()):r("error","更新優惠劵失敗")}).catch(i=>{var m,$;const _=(($=(m=i.response)==null?void 0:m.data)==null?void 0:$.message)||"發生錯誤，請稍後再試";r("error",_)}).finally(()=>{t.value=!1})}}function E(){const d=`${g}api/${x}/admin/coupon/${u.value.id}`;t.value=!0,p.delete(d).then(s=>{s.data.success?(r("success","刪除優惠劵成功"),n.value.hideModal(),l()):r("error","刪除優惠劵失敗")}).catch(s=>{var _,m;const i=((m=(_=s.response)==null?void 0:_.data)==null?void 0:m.message)||"發生錯誤，請稍後再試";r("error",i)}).finally(()=>{t.value=!1})}return L(()=>{l()}),{coupons:e,tempCoupon:u,isLoading:t,isNew:c,couponModal:a,delModal:n,openCouponModal:M,openDelCouponModal:v,getCoupons:l,updateCoupon:V,delCoupon:E}}},no={class:"text-end mt-4"},lo={class:"table-responsive"},so={class:"table mt-4"},ao={class:"text-nowrap"},uo={key:0,class:"text-success"},io={key:1,class:"text-muted"},po={class:"btn-group"},co=["onClick"],ro=["onClick"];function mo(p,e,u,t,c,a){const n=k("VueLoading"),M=k("CouponModal"),v=k("DelModal");return f(),C("div",null,[D(n,{active:t.isLoading},null,8,["active"]),o("div",no,[o("button",{class:"btn btn-primary",type:"button",onClick:e[0]||(e[0]=l=>t.openCouponModal(!0))},e[1]||(e[1]=[o("i",{class:"bi bi-plus-lg pe-1"},null,-1),S("新增優惠券 ")]))]),o("div",lo,[o("table",so,[e[2]||(e[2]=o("thead",null,[o("tr",{class:"table-nowrap"},[o("th",null,"名稱"),o("th",{class:"text-nowrap"},"折扣百分比"),o("th",null,"到期日"),o("th",{class:"text-nowrap"},"是否啟用"),o("th",null,"編輯")])],-1)),o("tbody",null,[(f(!0),C(U,null,N(t.coupons,l=>(f(),C("tr",{key:`coupon ${l.id}`},[o("td",null,w(l.title),1),o("td",null,w(l.percent)+"%",1),o("td",ao,w(p.$format.date(l.due_date)),1),o("td",null,[l.is_enabled===1?(f(),C("span",uo,"啟用")):(f(),C("span",io,"未起用"))]),o("td",null,[o("div",po,[o("button",{class:"btn btn-outline-primary btn-sm",type:"button",onClick:V=>t.openCouponModal(!1,l)}," 編輯 ",8,co),o("button",{class:"btn btn-outline-danger btn-sm",type:"button",onClick:V=>t.openDelCouponModal(l)}," 刪除 ",8,ro)])])]))),128))])])]),D(M,{coupon:t.tempCoupon,ref:"couponModal",onUpdateCoupon:t.updateCoupon},null,8,["coupon","onUpdateCoupon"]),D(v,{item:t.tempCoupon,ref:"delModal",onDelItem:t.delCoupon},null,8,["item","onDelItem"])])}const fo=T(to,[["render",mo]]);export{fo as default};
